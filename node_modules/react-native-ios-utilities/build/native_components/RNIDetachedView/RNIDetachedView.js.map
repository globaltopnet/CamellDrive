{"version":3,"file":"RNIDetachedView.js","sourceRoot":"","sources":["../../../src/native_components/RNIDetachedView/RNIDetachedView.tsx"],"names":[],"mappings":"AAAA,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAC/B,OAAO,EAAqB,UAAU,EAAmB,MAAM,cAAc,CAAC;AAE9E,OAAO,EAAE,qBAAqB,EAAE,MAAM,yBAAyB,CAAC;AAChE,OAAO,EAAE,qBAAqB,EAAE,MAAM,yBAAyB,CAAC;AAEhE,OAAO,EAAE,kBAAkB,EAAE,MAAM,kCAAkC,CAAC;AAMtE,MAAM,OAAO,eAAgB,SAAQ,KAAK,CAAC,aAAyD;IAElG,SAAS,CAAQ;IACjB,QAAQ,CAAU;IAElB,YAAY,KAA2B;QACrC,KAAK,CAAC,KAAK,CAAC,CAAC;QAEb,IAAI,CAAC,KAAK,GAAG;YACX,UAAU,EAAE,KAAK;SAClB,CAAC;IACJ,CAAC;IAAA,CAAC;IAEF,oBAAoB;QAClB,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9B,IAAG,CAAC,KAAK,CAAC,mCAAmC;YAAE,OAAO;QAEtD,MAAM,QAAQ,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC1C,IAAG,OAAO,QAAQ,KAAK,QAAQ;YAAE,OAAO;QAExC,kBAAkB,CAAC,4BAA4B,CAC7C,QAAQ,EAAE;YACR,kBAAkB,EAAE,IAAI;YACxB,2BAA2B,EAAE,KAAK;SACnC,CACF,CAAC;IACJ,CAAC;IAAA,CAAC;IAEF,QAAQ;QACN,MAAM,EACJ,mCAAmC,EACnC,iBAAiB,EACjB,wBAAwB,EACxB,kCAAkC,EAClC,GAAG,SAAS,EACb,GAAG,IAAI,CAAC,KAAK,CAAC;QAEf,OAAO;YACL,mCAAmC,EACjC,mCAAmC,IAAI,KAAK;YAE9C,iBAAiB;YAEjB,wBAAwB,EACtB,wBAAwB,IAAI,IAAI;YAElC,kCAAkC,EAChC,kCAAkC,IAAI,KAAK;YAE7C,SAAS;SACV,CAAC;IACJ,CAAC;IAAA,CAAC;IAEF,YAAY,GAA2B,GAAG,EAAE;QAC1C,OAAO,IAAI,CAAC,SAAS,CAAC;IACxB,CAAC,CAAC;IAEF,iBAAiB,GAA6B,GAAG,EAAE;QACjD,aAAa;QACb,OAAO,IAAI,CAAC,SAAS,EAAE,SAAS,IAAI,IAAI,CAAC,QAAQ,CAAC;IACpD,CAAC,CAAC;IAEM,eAAe,GAAG,CAAC,KAAwB,EAAE,EAAE;QACrD,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,CAAC;QAE7B,aAAa;QACb,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC;IAC3C,CAAC,CAAC;IAEF,mBAAmB,GAAG,KAAK,IAAI,EAAE;QAC/B,MAAM,QAAQ,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC1C,IAAG,OAAO,QAAQ,KAAK,QAAQ;YAAE,OAAO;QAExC,MAAM,qBAAqB,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;IAC5D,CAAC,CAAC;IAEM,kBAAkB,GAAG,CAAC,GAAS,EAAE,EAAE;QACzC,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC;IACvB,CAAC,CAAC;IAEM,sBAAsB,GAAiC,CAAC,KAAK,EAAE,EAAE;QACvE,IAAI,CAAC,QAAQ,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;QACpC,IAAI,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,KAAK,CAAC,CAAC;IACtC,CAAC,CAAC;IAEF,MAAM;QACJ,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9B,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QAEzB,MAAM,cAAc,GAAG,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC;QAE7C,MAAM,mBAAmB,GAAc;YACrC,GAAG,CAAC,CAAC,KAAK,CAAC,UAAU,IAAI;gBACvB,OAAO,EAAE,KAAK;gBACd,KAAK,EAAE,CAAC;gBACR,MAAM,EAAE,CAAC;aACV,CAAC;SACH,CAAC;QAEF,OAAO,KAAK,CAAC,aAAa,CAAC,qBAAqB,EAAE;YAChD,GAAG,KAAK,CAAC,SAAS;YAClB,KAAK,EAAE,CAAC,KAAK,CAAC,wBAAwB,CAAC,CAAC,CAAC;gBACvC,KAAK,CAAC,SAAS,CAAC,KAAK;gBACrB,MAAM,CAAC,UAAU;gBACjB,mBAAmB;aACpB,CAAC,CAAC,CAAC;gBACF,KAAK,CAAC,SAAS,CAAC,KAAK;aACtB,CAAC;YACF,aAAa;YACb,GAAG,EAAE,IAAI,CAAC,kBAAkB;YAC5B,QAAQ,EAAE,CAAC,cAAc;gBACvB,CAAC,CAAC,SAAS;gBACX,CAAC,CAAC,IAAI,CAAC,eAAe,CACvB;YACD,eAAe,EAAE,IAAI,CAAC,sBAAsB;YAC5C,mCAAmC,EAAE,KAAK,CAAC,mCAAmC;YAC9E,iBAAiB,EAAE,KAAK,CAAC,iBAAiB;SAC3C,CAAC,CAAC;IACL,CAAC;IAAA,CAAC;CACH;AAAA,CAAC;AAEF,MAAM,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC;IAC/B,UAAU,EAAE;QACV,QAAQ,EAAE,UAAU;KACrB;CACF,CAAC,CAAC","sourcesContent":["import * as React from 'react';\nimport { LayoutChangeEvent, StyleSheet, View, ViewStyle } from 'react-native';\n\nimport { RNIDetachedViewModule } from './RNIDetachedViewModule';\nimport { RNIDetachedNativeView } from './RNIDetachedNativeView';\n\nimport { RNIUtilitiesModule } from '../../modules/RNIUtilitiesModule';\n\nimport type { OnDetachedViewDidDetachEvent } from './RNIDetachedViewEvents';\nimport type { RNIDetachedViewProps, RNIDetachedViewState } from './RNIDetachedViewTypes';\n\n\nexport class RNIDetachedView extends React.PureComponent<RNIDetachedViewProps, RNIDetachedViewState> {\n  \n  nativeRef?: View;\n  reactTag?: number;\n\n  constructor(props: RNIDetachedViewProps){\n    super(props);\n\n    this.state = {\n      isDetached: false,\n    };\n  };\n\n  componentWillUnmount(){\n    const props = this.getProps();\n    if(!props.shouldCleanupOnComponentWillUnmount) return;\n\n    const reactTag = this.getNativeReactTag();\n    if(typeof reactTag !== 'number') return;\n\n    RNIUtilitiesModule.notifyOnComponentWillUnmount(\n      reactTag, {\n        shouldForceCleanup: true,\n        shouldIgnoreCleanupTriggers: false,\n      }\n    );\n  };\n\n  getProps() {\n    const { \n      shouldCleanupOnComponentWillUnmount,\n      contentTargetMode,\n      shouldApplyStyleOverride,\n      shouldNotifyOnComponentWillUnmount,\n      ...viewProps \n    } = this.props;\n\n    return {\n      shouldCleanupOnComponentWillUnmount: \n        shouldCleanupOnComponentWillUnmount ?? false,\n\n      contentTargetMode,\n\n      shouldApplyStyleOverride: \n        shouldApplyStyleOverride ?? true,\n\n      shouldNotifyOnComponentWillUnmount:\n        shouldNotifyOnComponentWillUnmount ?? false,\n\n      viewProps,\n    };\n  };\n\n  getNativeRef: () => View | undefined = () => {\n    return this.nativeRef;\n  };\n\n  getNativeReactTag: () => number | undefined = () => {\n    // @ts-ignore\n    return this.nativeRef?.nativeTag ?? this.reactTag;\n  };\n\n  private _handleOnLayout = (event: LayoutChangeEvent) => {\n    this.props.onLayout?.(event);\n\n    // @ts-ignore\n    this.reactTag = event.nativeEvent.target;\n  };\n\n  debugAttachToWindow = async () => {\n    const reactTag = this.getNativeReactTag();\n    if(typeof reactTag !== 'number') return;\n\n    await RNIDetachedViewModule.debugAttachToWindow(reactTag);\n  };\n\n  private _handleOnNativeRef = (ref: View) => {\n    this.nativeRef = ref;\n  };\n\n  private _handleOnViewDidDetach: OnDetachedViewDidDetachEvent = (event) => {\n    this.setState({ isDetached: true });\n    this.props.onViewDidDetach?.(event);\n  };\n\n  render(){\n    const props = this.getProps();\n    const state = this.state;\n\n    const didSetReactTag = this.reactTag != null;\n\n    const nativeStyleOverride: ViewStyle = {\n      ...(!state.isDetached && {\n        opacity: 0.001,\n        width: 0,\n        height: 0,\n      }),\n    };\n    \n    return React.createElement(RNIDetachedNativeView, {\n      ...props.viewProps,\n      style: (props.shouldApplyStyleOverride ? [\n        props.viewProps.style,\n        styles.nativeView,        \n        nativeStyleOverride,\n      ] : [\n        props.viewProps.style,\n      ]),\n      // @ts-ignore\n      ref: this._handleOnNativeRef,\n      onLayout: (didSetReactTag \n        ? undefined\n        : this._handleOnLayout\n      ),\n      onViewDidDetach: this._handleOnViewDidDetach,\n      shouldCleanupOnComponentWillUnmount: props.shouldCleanupOnComponentWillUnmount,\n      contentTargetMode: props.contentTargetMode,\n    });\n  };\n};\n\nconst styles = StyleSheet.create({\n  nativeView: {\n    position: 'absolute',\n  },\n});"]}