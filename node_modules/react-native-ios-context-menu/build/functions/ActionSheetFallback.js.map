{"version":3,"file":"ActionSheetFallback.js","sourceRoot":"","sources":["../../src/functions/ActionSheetFallback.ts"],"names":[],"mappings":"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","sourcesContent":["\nimport * as Helpers from './Helpers';\n\nimport type { MenuActionConfig, MenuConfig, MenuElementConfig } from '../types/MenuConfig';\n\n// TODO: Refactor/cleanup...\n// TODO: Fix types + remove `@ts-ignore`\n\nclass ActionSheetFallbackHelpers {\n  /** is the object a `MenuAction` item */\n  static isObjectMenuAction(object: object): object is MenuActionConfig {\n    return (\n      // required properties --------\n      ('actionKey'      in object) ||\n      ('actionTitle'    in object) ||\n\n      // optional properties --------------\n      ('menuState'            in object) ||\n      ('menuAttributes'       in object)\n    );\n  };\n  \n  /** is the object a `MenuObject` item */\n  static isObjectMenuConfig(object: object): object is MenuConfig {\n    return (\n      // required properties --------\n      ('menuTitle'      in object) ||\n\n      // optional properties -----\n      ('menuOptions' in object) ||\n      ('menuItems'   in object)\n    );\n  };\n\n  /** based on the `indexPath`, return the corresponding `MenuConfig` item */\n  static getItemFromMenuConfig(menuConfig: MenuConfig, indexPath: Array<number>){\n    if(indexPath  == null) return null;\n    if(menuConfig == null) return null;\n\n    let currentObject: MenuElementConfig | undefined = menuConfig;\n\n    for (const index of indexPath) {\n      if(currentObject == null){\n        return null;\n\n      } else if(currentObject?.type === 'deferred') {\n        return null;\n\n      } else if(ActionSheetFallbackHelpers.isObjectMenuAction(currentObject)){\n        return currentObject;\n\n      } else if (!ActionSheetFallbackHelpers.isObjectMenuConfig(currentObject)){\n        return null;\n      };\n\n      currentObject = currentObject?.menuItems?.[index];\n    };\n\n    return currentObject;\n  };\n\n  /** handle inline submenu's by hoisting submenu action to the parent menu */\n  static flattenMenuConfig(menuConfig: MenuConfig){\n    if(menuConfig == null) return null;\n\n    let indexPath = [0];\n    let currentParent = menuConfig;\n\n    const incrementCurrentIndexPath = () => {\n      const indexPathCount = indexPath.length;\n      // increment last index path\n      indexPath[indexPathCount - 1]++;\n    };\n\n    const getCurrentIndexPath = () => \n      (indexPath[indexPath.length - 1]);\n\n    const getCurrentParentItemsCount = () => \n      (currentParent?.menuItems?.length ?? 0);\n\n    const didReachEnd = () => \n      (getCurrentIndexPath() >= (getCurrentParentItemsCount() - 1));\n    \n    // traverse menu config until last item reached\n    while(true){\n      let currentItem = ActionSheetFallbackHelpers\n        .getItemFromMenuConfig(menuConfig, indexPath);\n\n      const isCurrentItemEmpty = (currentItem == null);\n\n      if (!isCurrentItemEmpty && ActionSheetFallbackHelpers.isObjectMenuConfig(currentItem!)){\n        // current item is menu config, check if inline submenu\n        const isInlineSubmenu = \n          currentItem!.menuOptions?.includes('displayInline') ?? false;\n\n        const inlineSubmenuItemsCount = \n          currentItem!.menuItems?.length ?? 0;\n\n        if(isInlineSubmenu && inlineSubmenuItemsCount > 0){\n          const inlineMenu = \n            currentParent?.menuItems!.splice(getCurrentIndexPath(), 1);\n\n          const inlineMenuItems = \n            // @ts-ignore\n            inlineMenu?.[0]?.menuItems ?? [];\n\n          currentParent?.menuItems!.splice(\n            getCurrentIndexPath(), 0, ...inlineMenuItems\n          );\n\n        } else {\n          // update currentParent\n          // @ts-ignore\n          currentParent = ActionSheetFallbackHelpers.getItemFromMenuConfig(menuConfig, indexPath);\n          // and traverse down...\n          indexPath.push(0);\n        };\n\n      } else if(didReachEnd()){\n        // reached last item, go to next item\n        indexPath.pop()\n        incrementCurrentIndexPath();\n\n        const indexPathCount = indexPath.length;\n        const nextIndexPath  = indexPath.slice(0, indexPathCount - 1);\n\n        // @ts-ignore\n        currentParent = ((indexPathCount <= 0)\n          ? menuConfig\n          : ActionSheetFallbackHelpers.getItemFromMenuConfig(menuConfig, nextIndexPath)\n        );\n\n        // last menu config item reached, stop...\n        if(didReachEnd() || indexPath.length < 1) break;\n\n      } else if(ActionSheetFallbackHelpers.isObjectMenuAction(currentItem!)){\n        // current item is menu action, skip...\n        incrementCurrentIndexPath();\n        \n      } else {\n        // current item unknown item, skip...\n        incrementCurrentIndexPath();\n      };\n    };\n\n    return menuConfig;\n  };\n  \n  /** returns the index of the first destructive action */\n  static getdestructiveButtonIndex(menuItems: MenuConfig['menuItems']){\n    if(menuItems == null) return null;\n    for (let index = 0; index < menuItems.length; index++) {\n      const menuItem = menuItems[index];\n\n      // @ts-ignore\n      const isDestructiveAction = menuItem?.menuAttributes\n        ?.includes('destructive') ?? false;\n\n      // @ts-ignore\n      const isDestructiveMenu = menuItem?.menuOptions\n        ?.includes('destructive') ?? false;\n\n      if(isDestructiveAction || isDestructiveMenu){\n        return index;\n      };\n    };\n\n    return null;\n  };\n\n  /** remove disabled/hidden menu actions */\n  static filterMenuItems(menuItems: MenuConfig['menuItems'] = []){\n    if(menuItems == null) return [];\n\n    return menuItems.filter(menuItem => {\n      // @ts-ignore\n      const isDisabledAction = menuItem?.menuAttributes\n        ?.includes('disabled') ?? false;\n\n      // @ts-ignore\n      const isHiddenAction = menuItem?.menuAttributes\n        ?.includes('hidden') ?? false;\n\n      const isDeferredElement = menuItem?.type === 'deferred';\n      \n      return (\n        !isDisabledAction && \n        !isHiddenAction && \n        !isDeferredElement\n      );\n    }) as Array<MenuConfig | MenuActionConfig>;\n  };\n};\n\nexport class ActionSheetFallback {\n  /** based on a `MenuConfig` object, show an `ActionSheetIOS` menu  */\n  static async show(menuConfig: MenuConfig){\n    let indexPath = [];\n\n    let actionSheetOptions     = [];\n    let cancelButtonIndex      = 0;\n    let destructiveButtonIndex = null;\n\n    const menuConfigCopy = JSON.parse(\n      JSON.stringify(menuConfig)\n    );\n\n    // handle 'inlineMenu' submenu's\n    ActionSheetFallbackHelpers.flattenMenuConfig(menuConfigCopy);\n\n    while(true){\n      const menuItem = \n        ActionSheetFallbackHelpers.getItemFromMenuConfig(menuConfigCopy, indexPath);\n\n      // selected item is an action, exit...\n      if(ActionSheetFallbackHelpers.isObjectMenuAction(menuItem!)){\n        return menuItem;\n      };\n\n      // selected item is menu, get submenu and remove hidden/disable actions\n      // @ts-ignore\n      const menuItems = ActionSheetFallbackHelpers.filterMenuItems(menuItem?.menuItems ?? []);\n      // add menu items to action sheet\n      // @ts-ignore\n      actionSheetOptions = menuItems.map(item => (\n        // @ts-ignore\n        item?.actionTitle ??\n        // @ts-ignore\n        item?.menuTitle   ?? null\n      ));\n\n      // set destructive index and offset by 1 bc of cancel button\n      // @ts-ignore\n      destructiveButtonIndex = ActionSheetFallbackHelpers.getdestructiveButtonIndex(menuItems);\n      if(destructiveButtonIndex != null) destructiveButtonIndex++;\n      \n      // wait for selected item\n      const selectedIndex = await Helpers.asyncActionSheet({\n        // action sheet config\n        ...((cancelButtonIndex      != null) && {cancelButtonIndex     }),\n        ...((destructiveButtonIndex != null) && {destructiveButtonIndex}),\n        options: ['cancel', ...actionSheetOptions],\n      });\n\n      // guard: cancel button pressed, exit...\n      if(selectedIndex === cancelButtonIndex) return null;\n\n      // push selected index to indexPath and loop\n      // @ts-ignore\n      indexPath.push(selectedIndex - 1);\n    };\n  };\n};\n"]}