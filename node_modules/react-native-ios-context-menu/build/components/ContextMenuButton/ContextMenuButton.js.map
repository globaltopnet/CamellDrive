{"version":3,"file":"ContextMenuButton.js","sourceRoot":"","sources":["../../../src/components/ContextMenuButton/ContextMenuButton.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport { StyleSheet, View, TouchableOpacity } from 'react-native';\n\nimport { RNIContextMenuButton } from '../../native_components/RNIContextMenuButton';\n\nimport type { OnMenuWillShowEvent, OnMenuWillHideEvent, OnMenuDidShowEvent, OnMenuDidHideEvent, OnMenuWillCancelEvent, OnMenuDidCancelEvent, OnPressMenuItemEvent, OnRequestDeferredElementEvent } from '../../types/MenuEvents';\nimport type { ContextMenuButtonProps, ContextMenuButtonState } from './ContextMenuButtonTypes';\n\n// @ts-ignore - TODO\nimport { ActionSheetFallback } from '../../functions/ActionSheetFallback';\nimport { ContextMenuView } from '../ContextMenuView';\n\nimport { ContextMenuButtonContext } from '../../context/ContextMenuButtonContext';\n\nimport { LIB_ENV, IS_PLATFORM_IOS } from '../../constants/LibEnv';\nimport type { MenuElementConfig } from '../../types/MenuConfig';\n\n\nexport class ContextMenuButton extends React.PureComponent<ContextMenuButtonProps, ContextMenuButtonState> {\n\n  nativeRef!: RNIContextMenuButton;\n\n  constructor(props: ContextMenuButtonProps){\n    super(props);\n\n    this.state = {\n      menuVisible: false,\n    };\n  };\n\n  getProps = () => {\n    const {\n      menuConfig,\n      isContextMenuEnabled,\n      isMenuPrimaryAction,\n      useActionSheetFallback,\n      internalViewCleanupMode,\n      onMenuWillShow,\n      onMenuWillHide,\n      onMenuWillCancel,\n      onMenuDidShow,\n      onMenuDidHide,\n      onMenuDidCancel,\n      onPressMenuItem,\n      onRequestDeferredElement,\n      ...viewProps \n    } = this.props;\n\n    return {\n      // A. Provide default values to props...\n      isContextMenuEnabled: (\n        isContextMenuEnabled ?? true\n      ),\n      useActionSheetFallback: (\n        useActionSheetFallback ?? !LIB_ENV.isContextMenuViewSupported\n      ),\n      internalViewCleanupMode: (\n        internalViewCleanupMode ?? { mode: 'default' }\n      ),\n      isMenuPrimaryAction: (\n        isMenuPrimaryAction ?? true\n      ),\n\n      // B. Pass down props...\n      menuConfig,\n      onMenuWillShow,\n      onMenuWillHide,\n      onMenuWillCancel,\n      onMenuDidShow,\n      onMenuDidHide,\n      onMenuDidCancel,\n      onPressMenuItem,\n      onRequestDeferredElement,\n      // C. Move all the default view-related\n      //    props here...\n      viewProps\n    };\n  };\n\n  presentMenu = async () => {\n    if(!LIB_ENV.isContextMenuViewSupported) return;\n    await this.nativeRef.presentMenu();\n  };\n\n  dismissMenu = async () => {\n    if(!LIB_ENV.isContextMenuButtonSupported) return;\n    this.nativeRef.dismissMenu();\n  };\n\n  provideDeferredElements = async (\n    deferredID: string, \n    menuItems: MenuElementConfig[]\n  ) => {\n    if(!LIB_ENV.isContextMenuViewSupported) return;\n\n    this.nativeRef.provideDeferredElements(\n      deferredID, menuItems\n    );\n  };\n\n  //#region - Handlers\n  _handleGetRefToContextMenuButton = () => {\n    return this;\n  };\n\n  _handleOnLongPress = async () => {\n    const props = this.props;\n\n    if(props.menuConfig == null) return;\n\n    const selectedItem = \n      await ActionSheetFallback.show(props.menuConfig);\n  \n    if(selectedItem == null){\n      // A. cancelled pressed\n      props.onMenuDidCancel?.({\n        isUsingActionSheetFallback: true\n      });\n\n    } else {\n      // B. an item was selected\n      props.onPressMenuItem?.({\n        isUsingActionSheetFallback: true,\n        nativeEvent: {\n          ...selectedItem,\n        }\n      });\n    };\n  };\n\n  _handleOnMenuWillShow: OnMenuWillShowEvent = (event) => {\n    this.props.onMenuWillShow?.(event);\n    event.stopPropagation();\n\n    this.setState({menuVisible: true});\n  };\n\n  _handleOnMenuWillHide: OnMenuWillHideEvent = (event) => {\n    this.props.onMenuWillHide?.(event);\n    event.stopPropagation();\n\n    this.setState({menuVisible: false});\n  };\n\n  _handleOnMenuWillCancel: OnMenuWillCancelEvent = (event) => {\n    this.props.onMenuWillCancel?.(event);\n    event.stopPropagation();\n  };\n\n  _handleOnMenuDidShow: OnMenuDidShowEvent = (event) => {\n    this.props.onMenuDidShow?.(event);\n    event.stopPropagation();\n  };\n\n  _handleOnMenuDidHide: OnMenuDidHideEvent = (event) => {\n    this.props.onMenuDidHide?.(event);\n    event.stopPropagation();\n  };\n\n  _handleOnMenuDidCancel: OnMenuDidCancelEvent = (event) => {\n    this.props.onMenuDidCancel?.(event);\n\n    // guard: event is a native event\n    if(event.isUsingActionSheetFallback) return;\n    event.stopPropagation();\n  };\n\n  _handleOnPressMenuItem: OnPressMenuItemEvent = (event) => {\n    this.props.onPressMenuItem?.(event);\n\n    // guard: event is a native event\n    if(event.isUsingActionSheetFallback) return;\n    event.stopPropagation();\n  };\n\n  private _handleOnRequestDeferredElement: OnRequestDeferredElementEvent = (event) => {\n    const { onRequestDeferredElement } = this.props;\n    const { deferredID } = event.nativeEvent;\n\n    onRequestDeferredElement?.(deferredID, (items) => {\n      this.provideDeferredElements(deferredID, items);\n    });\n  };\n  //#endregion\n\n  render(){\n    const props = this.getProps();\n    const state = this.state;\n\n    const shouldUseContextMenuButton = (\n      !props.useActionSheetFallback &&\n      LIB_ENV.isContextMenuButtonSupported\n    );\n\n    const shouldUseContextMenuView = (\n      !props.useActionSheetFallback &&\n      !LIB_ENV.isContextMenuButtonSupported &&\n      LIB_ENV.isContextMenuViewSupported\n    );\n\n    const shouldUseActionSheetFallback = (\n      IS_PLATFORM_IOS && props.useActionSheetFallback\n    );\n\n    // TODO: Rename to 'sharedProps'\n    const nativeComponentProps = {\n      menuConfig: props.menuConfig,\n      isContextMenuEnabled: props.isContextMenuEnabled,\n      isMenuPrimaryAction: props.isMenuPrimaryAction,\n      internalViewCleanupMode: props.internalViewCleanupMode,\n\n      // event handlers\n      onMenuWillShow: this._handleOnMenuWillShow,\n      onMenuWillHide: this._handleOnMenuWillHide,\n      onMenuDidShow: this._handleOnMenuDidShow,\n      onMenuDidHide: this._handleOnMenuDidHide,\n      onMenuDidCancel: this._handleOnMenuDidCancel,\n      onMenuWillCancel: this._handleOnMenuWillCancel,\n      onPressMenuItem: this._handleOnPressMenuItem,\n      onRequestDeferredElement: this._handleOnRequestDeferredElement,\n    };\n    \n    const contents = (\n      shouldUseContextMenuButton? (\n        // A - Use 'RNIContextMenuButton'\n        <RNIContextMenuButton\n          {...props.viewProps}\n          {...nativeComponentProps}\n          ref={r => { this.nativeRef = r! }}\n          style={[styles.menuButton, props.viewProps.style]}\n        >\n          {props.viewProps.children}\n        </RNIContextMenuButton>\n      ): shouldUseContextMenuView? (\n        // B - Use 'ContextMenuView' Fallback\n        <ContextMenuView\n          {...props.viewProps}\n          {...nativeComponentProps}\n          onRequestDeferredElement={props.onRequestDeferredElement}\n        >\n          {props.viewProps.children}\n        </ContextMenuView>\n      ): shouldUseActionSheetFallback? (\n        // C - Use 'ActionSheet' Fallback\n        <TouchableOpacity \n          onLongPress={this._handleOnLongPress}\n          activeOpacity={0.8}\n          {...props.viewProps}\n        >\n          {this.props.children}\n        </TouchableOpacity>\n      ): (\n        // D - Use Regular View\n        <View {...props.viewProps}>\n          {this.props.children}\n        </View>\n      )\n    );\n\n    return (\n      <ContextMenuButtonContext.Provider value={{\n        getRefToContextMenuButton: this._handleGetRefToContextMenuButton,\n        isMenuVisible: state.menuVisible,\n      }}>\n        {contents}\n      </ContextMenuButtonContext.Provider>\n    );\n  };\n};\n\nconst styles = StyleSheet.create({\n  menuButton: {\n    backgroundColor: 'transparent',\n  },\n});"]}