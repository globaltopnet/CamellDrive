{"version":3,"names":["_react","require","_AnimatedImage","_moduleWrapper","DEFAULT_FRAME_DURATION","useAnimatedImageValue","source","throwOnMissingReanimated","currentFrame","useSharedValue","lastTimestamp","animatedImage","useAnimatedImage","err","console","error","Error","message","frameDuration","currentFrameDuration","useFrameCallback","frameInfo","value","timestamp","elapsed","decodeNextFrame","dispose","getCurrentFrame","useEffect","exports"],"sources":["useAnimatedImageValue.ts"],"sourcesContent":["import { useEffect } from \"react\";\nimport type { FrameInfo } from \"react-native-reanimated\";\n\nimport { useAnimatedImage } from \"../../skia/core/AnimatedImage\";\nimport type { DataSourceParam, SkImage } from \"../../skia/types\";\n\nimport {\n  throwOnMissingReanimated,\n  useFrameCallback,\n  useSharedValue,\n} from \"./moduleWrapper\";\n\nconst DEFAULT_FRAME_DURATION = 60;\n\nexport const useAnimatedImageValue = (source: DataSourceParam) => {\n  throwOnMissingReanimated();\n  const currentFrame = useSharedValue<null | SkImage>(null);\n  const lastTimestamp = useSharedValue(0);\n  const animatedImage = useAnimatedImage(\n    source,\n    (err) => {\n      console.error(err);\n      throw new Error(`Could not load animated image - got '${err.message}'`);\n    },\n    false\n  );\n  const frameDuration =\n    animatedImage?.currentFrameDuration() || DEFAULT_FRAME_DURATION;\n\n  useFrameCallback((frameInfo: FrameInfo) => {\n    if (!animatedImage) {\n      currentFrame.value = null;\n      return;\n    }\n\n    const { timestamp } = frameInfo;\n    const elapsed = timestamp - lastTimestamp.value;\n\n    // Check if it's time to switch frames based on GIF frame duration\n    if (elapsed < frameDuration) {\n      return;\n    }\n\n    // Update the current frame\n    animatedImage.decodeNextFrame();\n    if (currentFrame.value) {\n      currentFrame.value.dispose();\n    }\n    currentFrame.value = animatedImage.getCurrentFrame();\n\n    // Update the last timestamp\n    lastTimestamp.value = timestamp;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, true);\n  useEffect(() => {\n    return () => {\n      animatedImage?.dispose();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return currentFrame;\n};\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAGA,IAAAC,cAAA,GAAAD,OAAA;AAGA,IAAAE,cAAA,GAAAF,OAAA;AAMA,MAAMG,sBAAsB,GAAG,EAAE;AAE1B,MAAMC,qBAAqB,GAAIC,MAAuB,IAAK;EAChE,IAAAC,uCAAwB,EAAC,CAAC;EAC1B,MAAMC,YAAY,GAAG,IAAAC,6BAAc,EAAiB,IAAI,CAAC;EACzD,MAAMC,aAAa,GAAG,IAAAD,6BAAc,EAAC,CAAC,CAAC;EACvC,MAAME,aAAa,GAAG,IAAAC,+BAAgB,EACpCN,MAAM,EACLO,GAAG,IAAK;IACPC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;IAClB,MAAM,IAAIG,KAAK,CAAE,wCAAuCH,GAAG,CAACI,OAAQ,GAAE,CAAC;EACzE,CAAC,EACD,KACF,CAAC;EACD,MAAMC,aAAa,GACjB,CAAAP,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEQ,oBAAoB,CAAC,CAAC,KAAIf,sBAAsB;EAEjE,IAAAgB,+BAAgB,EAAEC,SAAoB,IAAK;IACzC,IAAI,CAACV,aAAa,EAAE;MAClBH,YAAY,CAACc,KAAK,GAAG,IAAI;MACzB;IACF;IAEA,MAAM;MAAEC;IAAU,CAAC,GAAGF,SAAS;IAC/B,MAAMG,OAAO,GAAGD,SAAS,GAAGb,aAAa,CAACY,KAAK;;IAE/C;IACA,IAAIE,OAAO,GAAGN,aAAa,EAAE;MAC3B;IACF;;IAEA;IACAP,aAAa,CAACc,eAAe,CAAC,CAAC;IAC/B,IAAIjB,YAAY,CAACc,KAAK,EAAE;MACtBd,YAAY,CAACc,KAAK,CAACI,OAAO,CAAC,CAAC;IAC9B;IACAlB,YAAY,CAACc,KAAK,GAAGX,aAAa,CAACgB,eAAe,CAAC,CAAC;;IAEpD;IACAjB,aAAa,CAACY,KAAK,GAAGC,SAAS;IAC/B;EACF,CAAC,EAAE,IAAI,CAAC;EACR,IAAAK,gBAAS,EAAC,MAAM;IACd,OAAO,MAAM;MACXjB,aAAa,aAAbA,aAAa,eAAbA,aAAa,CAAEe,OAAO,CAAC,CAAC;IAC1B,CAAC;IACD;EACF,CAAC,EAAE,EAAE,CAAC;EACN,OAAOlB,YAAY;AACrB,CAAC;AAACqB,OAAA,CAAAxB,qBAAA,GAAAA,qBAAA"}