"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[417],{739:function(e,t,r){r.r(t),r.d(t,{SignIn:function(){return ue},SignInModal:function(){return fe}});var o=r(4380),n=r(4041),i=r(9251),a=r(4740),s=r(9333),l=r(166),c=r(5882),d=r(5220),u=r(2932),f=r(7157),p=r(1101),h=r(3150);const g=(0,d.K5)((0,u.withCardStateProvider)((()=>{const e=(0,a.useCoreSignIn)(),t=(0,u.useCardState)(),{navigate:r}=(0,l.useRouter)(),i=(0,p.p)(),{userSettings:{passwordSettings:d}}=(0,a.useEnvironment)(),{t:g,locale:m}=(0,s.useLocalizations)(),C="needs_new_password"===e.status&&"reset_password_email_code"!==e.firstFactorVerification.strategy&&"reset_password_phone_code"!==e.firstFactorVerification.strategy;n.useEffect((()=>{C&&t.setError(g((0,s.localizationKeys)("signIn.resetPassword.requiredMessage")))}),[]);const v=(0,h.tJ)("password","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__newPassword"),isRequired:!0,validatePassword:!0,buildErrorMessage:e=>(0,h.C5)(e,{t:g,locale:m,passwordSettings:d})}),w=(0,h.tJ)("confirmPassword","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__confirmPassword"),isRequired:!0}),S=(0,h.tJ)("signOutOfOtherSessions","",{type:"checkbox",label:(0,s.localizationKeys)("formFieldLabel__signOutOfOtherSessions"),defaultChecked:!0}),{setConfirmPasswordFeedback:I,isPasswordMatch:k}=(0,f.Zg)({passwordField:v,confirmPasswordField:w}),y=k;return(0,o.FD)(u.Card,{children:[(0,o.Y)(u.CardAlert,{children:t.error}),(0,o.FD)(u.Header.Root,{children:[(0,o.Y)(u.Header.BackLink,{onClick:()=>r("../")}),(0,o.Y)(u.Header.Title,{localizationKey:(0,s.localizationKeys)("signIn.resetPassword.title")})]}),(0,o.Y)(s.Col,{elementDescriptor:s.descriptors.main,gap:8,children:(0,o.FD)(u.Form.Root,{onSubmit:async()=>{v.setError(void 0),w.setError(void 0);try{const{status:t,createdSessionId:o}=await e.resetPassword({password:v.value,signOutOfOtherSessions:S.checked});switch(t){case"complete":if(o){const e=new URLSearchParams;return e.set("createdSessionId",o),r(`../reset-password-success?${e.toString()}`)}return console.error((0,c.wv)(t,i));case"needs_second_factor":return r("../factor-two");default:return console.error((0,c.wv)(t,i))}}catch(o){(0,h.H4)(o,[v,w],t.setError)}},onBlur:()=>{v.value&&I(w.value)},children:[(0,o.Y)("input",{readOnly:!0,"data-testid":"hidden-identifier",id:"identifier-field",name:"identifier",value:e.identifier||"",style:{display:"none"}}),(0,o.Y)(u.Form.ControlRow,{elementId:v.id,children:(0,o.Y)(u.Form.Control,{...v.props,required:!0,autoFocus:!0})}),(0,o.Y)(u.Form.ControlRow,{elementId:w.id,children:(0,o.Y)(u.Form.Control,{...w.props,onChange:e=>(e.target.value&&I(e.target.value),w.props.onChange(e))})}),!C&&(0,o.Y)(u.Form.ControlRow,{elementId:S.id,children:(0,o.Y)(u.Form.Control,{...S.props})}),(0,o.Y)(u.Form.SubmitButton,{isDisabled:!y,localizationKey:(0,s.localizationKeys)("signIn.resetPassword.formButtonPrimary")})]})})]})})));var m=r(9065),C=r(2986);const v=(0,d.K5)((0,u.withCardStateProvider)((()=>{const e=(0,u.useCardState)();return(0,m.h)(),(0,o.FD)(u.Card,{children:[(0,o.Y)(u.CardAlert,{children:e.error}),(0,o.Y)(u.Header.Root,{children:(0,o.Y)(u.Header.Title,{localizationKey:(0,s.localizationKeys)("signIn.resetPassword.title")})}),(0,o.FD)(s.Col,{elementDescriptor:s.descriptors.main,gap:8,children:[(0,o.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("signIn.resetPassword.successMessage"),variant:"smallRegular",colorScheme:"inherit"}),(0,o.Y)(C.so,{direction:"row",center:!0,children:(0,o.Y)(C.y$,{size:"xl",colorScheme:"primary"})})]})]})})));var w=r(1368),S=r(1241),I=r(2407),k=r(3962);const y=(0,d.K5)((0,u.withCardStateProvider)((()=>{const e=(0,S.f0)(),{navigate:t}=(0,l.useRouter)(),{applicationName:r,userProfileUrl:n,signInUrl:i,afterSignOutAllUrl:c}=(0,a.useEnvironment)().displayConfig,{navigateAfterSignIn:d}=(0,a.useSignInContext)(),{handleSignOutAllClicked:f,handleSessionClicked:p,activeSessions:h,handleAddAccountClicked:g}=(0,k.u)({navigateAfterSignOut:()=>t(c),navigateAfterSwitchSession:d,userProfileUrl:n,signInUrl:i,user:void 0});return(0,o.Y)(s.Flow.Part,{part:"accountSwitcher",children:(0,o.FD)(u.Card,{children:[(0,o.Y)(u.CardAlert,{children:e.error}),(0,o.FD)(u.Header.Root,{children:[(0,o.Y)(u.Header.Title,{children:"Signed out"}),(0,o.FD)(u.Header.Subtitle,{children:["Select account to continue to ",r]})]}),(0,o.FD)(s.Col,{elementDescriptor:s.descriptors.main,gap:8,children:[(0,o.Y)(s.Col,{children:h.map((e=>(0,o.Y)(u.PreviewButton,{onClick:p(e),sx:e=>({height:e.sizes.$14,justifyContent:"flex-start"}),children:(0,o.Y)(u.UserPreview,{user:e.user})},e.id)))}),(0,o.FD)(s.Col,{gap:2,children:[(0,o.Y)(w.X,{isDisabled:e.isLoading,leftIcon:(0,o.Y)(s.Icon,{size:"sm",icon:I.FW,sx:e=>({color:e.colors.$blackAlpha500})}),onClick:g,children:"Add account"}),(0,o.Y)(w.X,{isDisabled:e.isLoading,leftIcon:(0,o.Y)(s.Icon,{icon:I.fh,sx:e=>({color:e.colors.$blackAlpha500})}),onClick:f,children:"Sign out of all accounts"})]})]})]})})})));var _=r(6588),F=r(2234),b=r(7453),Y=r(9351),A=r(7708);const K=n.memo((e=>{const t=(0,a.useCoreClerk)(),{navigate:r}=(0,l.useRouter)(),n=(0,S.f0)(),{displayConfig:i}=(0,Y.O)(),s=(0,a.useSignInContext)(),c=(0,a.useCoreSignIn)(),d=(0,b.u)(s,i.signInUrl),u=s.afterSignInUrl||i.afterSignInUrl;return(0,o.Y)(A.V,{...e,oauthCallback:e=>c.authenticateWithRedirect({strategy:e,redirectUrl:d,redirectUrlComplete:u}).catch((e=>(0,h.H4)(e,[],n.setError))),web3Callback:()=>t.authenticateWithMetamask({customNavigate:r,redirectUrl:u,signUpContinueUrl:s.signUpContinueUrl}).catch((e=>(0,h.H4)(e,[],n.setError)))})}));var P=r(3863);function z(){return(0,a.useCoreSignIn)().supportedFirstFactors.find((({strategy:e})=>(0,P.Kw)(e)))}const L=e=>{const{onBackLinkClick:t}=e;return(0,o.Y)(u.ErrorCard,{cardTitle:(0,s.localizationKeys)("signIn.alternativeMethods.getHelp.title"),onBackLinkClick:t})},E=e=>((e,t)=>{const[r,i]=n.useState(!1),a=n.useCallback((()=>i((e=>!e))),[i]);return r?(0,o.Y)(L,{onBackLinkClick:a}):(0,o.Y)(e,{...t,onHavingTroubleClick:a})})(M,{...e}),M=e=>{const{onBackLinkClick:t,onHavingTroubleClick:r,onFactorSelected:n,mode:i="default"}=e,a=(0,S.f0)(),l=z(),{firstPartyFactors:c,hasAnyStrategy:d}=(0,_.y)({filterOutFactor:null==e?void 0:e.currentFactor}),f=function(e){switch(e){case"forgot":return"forgotPasswordMethods";case"pwned":return"passwordPwnedMethods";default:return"alternativeMethods"}}(i),p=function(e){switch(e){case"forgot":return(0,s.localizationKeys)("signIn.forgotPasswordAlternativeMethods.title");case"pwned":return(0,s.localizationKeys)("signIn.passwordPwned.title");default:return(0,s.localizationKeys)("signIn.alternativeMethods.title")}}(i),h=function(e){switch(e){case"forgot":case"pwned":return!0;default:return!1}}(i);return(0,o.Y)(s.Flow.Part,{part:f,children:(0,o.FD)(u.Card,{children:[(0,o.Y)(u.CardAlert,{children:a.error}),(0,o.FD)(u.Header.Root,{children:[t&&(0,o.Y)(u.Header.BackLink,{onClick:t}),(0,o.Y)(u.Header.Title,{localizationKey:p})]}),(0,o.FD)(s.Flex,{direction:"col",elementDescriptor:s.descriptors.main,gap:6,children:[h&&l&&(0,o.Y)(u.ArrowBlockButton,{leftIcon:B(l),textLocalizationKey:R(l),elementDescriptor:s.descriptors.alternativeMethodsBlockButton,textElementDescriptor:s.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:s.descriptors.alternativeMethodsBlockButtonArrow,isDisabled:a.isLoading,onClick:()=>{a.setError(void 0),n(l)}}),d&&(0,o.FD)(o.FK,{children:[h&&(0,o.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("signIn.forgotPasswordAlternativeMethods.label__alternativeMethods")}),(0,o.FD)(s.Flex,{elementDescriptor:s.descriptors.alternativeMethods,direction:"col",gap:2,children:[(0,o.Y)(K,{enableWeb3Providers:!0,enableOAuthProviders:!0}),c.map(((e,t)=>(0,o.Y)(u.ArrowBlockButton,{leftIcon:B(e),textLocalizationKey:R(e),elementDescriptor:s.descriptors.alternativeMethodsBlockButton,textElementDescriptor:s.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:s.descriptors.alternativeMethodsBlockButtonArrow,isDisabled:a.isLoading,onClick:()=>{a.setError(void 0),n(e)}},t)))]})]})]}),(0,o.FD)(u.Footer.Root,{children:[(0,o.Y)(u.Footer.Action,{elementId:"havingTrouble",children:(0,o.Y)(u.Footer.ActionLink,{localizationKey:(0,s.localizationKeys)("signIn.alternativeMethods.actionLink"),onClick:r})}),(0,o.Y)(u.Footer.Links,{})]})]})})};function R(e){switch(e.strategy){case"email_link":return(0,s.localizationKeys)("signIn.alternativeMethods.blockButton__emailLink",{identifier:(0,h.uu)(e.safeIdentifier)||""});case"email_code":return(0,s.localizationKeys)("signIn.alternativeMethods.blockButton__emailCode",{identifier:(0,h.uu)(e.safeIdentifier)||""});case"phone_code":return(0,s.localizationKeys)("signIn.alternativeMethods.blockButton__phoneCode",{identifier:(0,h.uu)(e.safeIdentifier)||""});case"password":return(0,s.localizationKeys)("signIn.alternativeMethods.blockButton__password");case"reset_password_email_code":case"reset_password_phone_code":return(0,s.localizationKeys)("signIn.forgotPasswordAlternativeMethods.blockButton__resetPassword");default:throw`Invalid sign in strategy: "${e.strategy}"`}}function B(e){return{email_link:I.qY,email_code:I.Ps,phone_code:I.bK,reset_password_email_code:I.Zm,reset_password_phone_code:I.Zm,password:I.JD}[e.strategy]}var D=r(6874);const T=e=>{const t=(0,a.useCoreSignIn)(),r=(0,u.useCardState)(),{navigate:i}=(0,l.useRouter)(),{navigateAfterSignIn:s}=(0,a.useSignInContext)(),{setActive:d}=(0,a.useCoreClerk)(),f=(0,p.p)(),g=(0,a.useCoreClerk)();n.useEffect((()=>{e.factorAlreadyPrepared||m()}),[]);const m=()=>{t.prepareFirstFactor(e.factor).then((()=>e.onFactorPrepare())).catch((e=>(0,h.H4)(e,[],r.setError)))};return(0,o.Y)(u.VerificationCodeCard,{cardTitle:e.cardTitle,cardSubtitle:e.cardSubtitle,formTitle:e.formTitle,formSubtitle:e.formSubtitle,resendButton:e.resendButton,onCodeEntryFinishedAction:(r,o,n)=>{t.attemptFirstFactor({strategy:e.factor.strategy,code:r}).then((async e=>{switch(await o(),e.status){case"complete":return d({session:e.createdSessionId,beforeEmit:s});case"needs_second_factor":return i("../factor-two");case"needs_new_password":return i("../reset-password");default:return console.error((0,c.wv)(e.status,f))}})).catch((e=>(0,D._d)(e)?g.__internal_navigateWithError("..",e.errors[0]):n(e)))},onResendCodeClicked:m,safeIdentifier:e.factor.safeIdentifier,profileImageUrl:t.userData.imageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked,showAlternativeMethods:e.showAlternativeMethods,onIdentityPreviewEditClicked:()=>i("../"),onBackLinkClicked:e.onBackLinkClicked})},U=e=>{const{applicationName:t}=(0,a.useEnvironment)().displayConfig;return(0,o.Y)(s.Flow.Part,{part:"emailCode",children:(0,o.Y)(T,{...e,cardTitle:(0,s.localizationKeys)("signIn.emailCode.title"),cardSubtitle:(0,s.localizationKeys)("signIn.emailCode.subtitle",{applicationName:t}),formTitle:(0,s.localizationKeys)("signIn.emailCode.formTitle"),formSubtitle:(0,s.localizationKeys)("signIn.emailCode.formSubtitle"),resendButton:(0,s.localizationKeys)("signIn.emailCode.resendButton")})})};var O=r(9859),x=r(6910),H=r(8622);const N=e=>{const{t:t}=(0,s.useLocalizations)(),r=(0,S.f0)(),i=(0,a.useCoreSignIn)(),l=(0,a.useSignInContext)(),{signInUrl:c}=(0,a.useEnvironment)().displayConfig,{navigate:f}=(0,H.r)(),{navigateAfterSignIn:p}=(0,a.useSignInContext)(),{setActive:g}=(0,a.useCoreClerk)(),{startEmailLinkFlow:m,cancelEmailLinkFlow:C}=(0,x.u)(i),[v,w]=n.useState(!1),I=(0,a.useCoreClerk)();n.useEffect((()=>{k()}),[]);const k=()=>{m({emailAddressId:e.factor.emailAddressId,redirectUrl:(0,b.W)(l,c)}).then((e=>y(e))).catch((e=>{if((0,O._d)(e))return I.__internal_navigateWithError("..",e.errors[0]);(0,h.H4)(e,[],r.setError)}))},y=async e=>{const o=e.firstFactorVerification;"expired"===o.status?r.setError(t((0,s.localizationKeys)("formFieldError__verificationLinkExpired"))):o.verifiedFromTheSameClient()?w(!0):await _(e)},_=async e=>"complete"===e.status?g({session:e.createdSessionId,beforeEmit:p}):"needs_second_factor"===e.status?f("../factor-two"):void 0;return v?(0,o.Y)(d.$W,{title:(0,s.localizationKeys)("signIn.emailLink.verifiedSwitchTab.titleNewTab"),subtitle:(0,s.localizationKeys)("signIn.emailLink.verifiedSwitchTab.subtitleNewTab"),status:"verified_switch_tab"}):(0,o.Y)(s.Flow.Part,{part:"emailLink",children:(0,o.Y)(u.VerificationLinkCard,{cardTitle:(0,s.localizationKeys)("signIn.emailLink.title"),cardSubtitle:(0,s.localizationKeys)("signIn.emailLink.subtitle"),formTitle:(0,s.localizationKeys)("signIn.emailLink.formTitle"),formSubtitle:(0,s.localizationKeys)("signIn.emailLink.formSubtitle"),resendButton:(0,s.localizationKeys)("signIn.emailLink.resendButton"),onResendCodeClicked:()=>{C(),k()},safeIdentifier:e.factor.safeIdentifier,profileImageUrl:i.userData.imageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked})})},V=e=>(0,o.Y)(s.Flow.Part,{part:"resetPassword",children:(0,o.Y)(T,{...e,showAlternativeMethods:!1,cardSubtitle:(0,s.localizationKeys)("signIn.forgotPassword.subtitle"),formTitle:(0,s.localizationKeys)("signIn.forgotPassword.formTitle"),resendButton:(0,s.localizationKeys)("signIn.forgotPassword.resendButton")})}),W=e=>{const{onShowAlternativeMethodsClick:t,onPasswordPwned:r}=e,i=(0,u.useCardState)(),{setActive:l}=(0,a.useCoreClerk)(),d=(0,a.useCoreSignIn)(),{navigateAfterSignIn:f}=(0,a.useSignInContext)(),g=(0,p.p)(),m=(e=>{const{onForgotPasswordMethodClick:t,onShowAlternativeMethodsClick:r}=e,o=z(),n=(0,h.tJ)("password","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__password"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__password")});return{...n,props:{...n.props,actionLabel:o||r?(0,s.localizationKeys)("formFieldAction__forgotPassword"):"",onActionClicked:t||r||(()=>null)}}})(e),{navigate:C}=(0,H.r)(),[v,w]=n.useState(!1),S=n.useCallback((()=>w((e=>!e))),[w]),I=(0,a.useCoreClerk)();return v?(0,o.Y)(L,{onBackLinkClick:S}):(0,o.Y)(s.Flow.Part,{part:"password",children:(0,o.FD)(u.Card,{children:[(0,o.Y)(u.CardAlert,{children:i.error}),(0,o.FD)(u.Header.Root,{children:[(0,o.Y)(u.Header.Title,{localizationKey:(0,s.localizationKeys)("signIn.password.title")}),(0,o.Y)(u.Header.Subtitle,{localizationKey:(0,s.localizationKeys)("signIn.password.subtitle")})]}),(0,o.Y)(u.IdentityPreview,{identifier:d.identifier,avatarUrl:d.userData.imageUrl,onClick:()=>C("../")}),(0,o.Y)(s.Flex,{direction:"col",elementDescriptor:s.descriptors.main,gap:8,children:(0,o.FD)(u.Form.Root,{onSubmit:async e=>(e.preventDefault(),d.attemptFirstFactor({strategy:"password",password:m.value}).then((e=>{switch(e.status){case"complete":return l({session:e.createdSessionId,beforeEmit:f});case"needs_second_factor":return C("../factor-two");default:return console.error((0,c.wv)(e.status,g))}})).catch((e=>(0,O._d)(e)?I.__internal_navigateWithError("..",e.errors[0]):(0,O.Au)(e)&&r?(i.setError({...e.errors[0],code:"form_password_pwned__sign_in"}),void r()):void(0,h.H4)(e,[m],i.setError)))),children:[(0,o.Y)("input",{readOnly:!0,id:"identifier-field",name:"identifier",value:d.identifier||"",style:{display:"none"}}),(0,o.Y)(u.Form.ControlRow,{elementId:m.id,children:(0,o.Y)(u.Form.Control,{...m.props,autoFocus:!0})}),(0,o.Y)(u.Form.SubmitButton,{})]})}),(0,o.FD)(u.Footer.Root,{children:[(0,o.Y)(u.Footer.Action,{elementId:t?"alternativeMethods":"havingTrouble",children:(0,o.Y)(u.Footer.ActionLink,{localizationKey:(0,s.localizationKeys)(t?"signIn.password.actionLink":"signIn.alternativeMethods.actionLink"),onClick:t||S})}),(0,o.Y)(u.Footer.Links,{})]})]})})},Q=e=>{const{applicationName:t}=(0,a.useEnvironment)().displayConfig;return(0,o.Y)(s.Flow.Part,{part:"phoneCode",children:(0,o.Y)(T,{...e,cardTitle:(0,s.localizationKeys)("signIn.phoneCode.title"),cardSubtitle:(0,s.localizationKeys)("signIn.phoneCode.subtitle",{applicationName:t}),formTitle:(0,s.localizationKeys)("signIn.phoneCode.formTitle"),formSubtitle:(0,s.localizationKeys)("signIn.phoneCode.formSubtitle"),resendButton:(0,s.localizationKeys)("signIn.phoneCode.resendButton")})})},G=e=>{if(!e)return"";let t=e.strategy;return"emailAddressId"in e&&(t+=e.emailAddressId),"phoneNumberId"in e&&(t+=e.phoneNumberId),t},$=(0,d.K5)((0,u.withCardStateProvider)((function(){const e=(0,a.useCoreSignIn)(),{preferredSignInStrategy:t}=(0,a.useEnvironment)().displayConfig,r=e.supportedFirstFactors,i=(0,l.useRouter)(),s=(0,u.useCardState)(),c=n.useRef(""),[{currentFactor:d},f]=n.useState((()=>({currentFactor:(0,P.xf)(r,e.identifier,t),prevCurrentFactor:void 0}))),{hasAnyStrategy:p}=(0,_.y)({filterOutFactor:d}),[h,g]=n.useState((()=>!d||!(0,P.Cm)(d))),m=z(),[C,v]=n.useState(!1),[w,S]=n.useState(!1);if(n.useEffect((()=>{"needs_identifier"!==e.status&&null!==e.status||i.navigate("../")}),[]),!d&&e.status)return(0,o.Y)(u.ErrorCard,{cardTitle:(0,F.GQ)("signIn.noAvailableMethods.title"),cardSubtitle:(0,F.GQ)("signIn.noAvailableMethods.subtitle"),message:(0,F.GQ)("signIn.noAvailableMethods.message")});const I=p?()=>g((e=>!e)):void 0,k=()=>v((e=>!e)),y=()=>{c.current=G(d)};if(h||C){const e=(0,P.Cm)(d),t=h?I:k,r=()=>{s.setError(void 0),S(!1),null==t||t()},n=C?w?"pwned":"forgot":"default";return(0,o.Y)(E,{mode:n,onBackLinkClick:e?r:void 0,onFactorSelected:e=>{var r;r=e,f((e=>({currentFactor:r,prevCurrentFactor:e.currentFactor}))),null==t||t()},currentFactor:d})}if(!d)return(0,o.Y)(u.LoadingCard,{});switch(null==d?void 0:d.strategy){case"password":return(0,o.Y)(W,{onFactorPrepare:e=>{y(),f((t=>({currentFactor:{...e},prevCurrentFactor:t.currentFactor})))},onForgotPasswordMethodClick:m?k:I,onShowAlternativeMethodsClick:I,onPasswordPwned:()=>{S(!0),k()}});case"email_code":return(0,o.Y)(U,{factorAlreadyPrepared:c.current===G(d),onFactorPrepare:y,factor:d,onShowAlternativeMethodsClicked:I});case"phone_code":return(0,o.Y)(Q,{factorAlreadyPrepared:c.current===G(d),onFactorPrepare:y,factor:d,onShowAlternativeMethodsClicked:I});case"email_link":return(0,o.Y)(N,{factorAlreadyPrepared:c.current===G(d),onFactorPrepare:y,factor:d,onShowAlternativeMethodsClicked:I});case"reset_password_phone_code":return(0,o.Y)(V,{factorAlreadyPrepared:c.current===G(d),onFactorPrepare:y,factor:d,onShowAlternativeMethodsClicked:I,onBackLinkClicked:()=>{f((e=>({currentFactor:e.prevCurrentFactor,prevCurrentFactor:e.currentFactor}))),k()},cardTitle:(0,F.GQ)("signIn.forgotPassword.title_phone"),formSubtitle:(0,F.GQ)("signIn.forgotPassword.formSubtitle_phone")});case"reset_password_email_code":return(0,o.Y)(V,{factorAlreadyPrepared:c.current===G(d),onFactorPrepare:y,factor:d,onShowAlternativeMethodsClicked:I,onBackLinkClicked:()=>{f((e=>({currentFactor:e.prevCurrentFactor,prevCurrentFactor:e.currentFactor}))),k()},cardTitle:(0,F.GQ)("signIn.forgotPassword.title_email"),formSubtitle:(0,F.GQ)("signIn.forgotPassword.formSubtitle_email")});default:return(0,o.Y)(u.LoadingCard,{})}}))),J=e=>{const[t,r]=n.useState(!1),i=n.useCallback((()=>r((e=>!e))),[r]);return t?(0,o.Y)(L,{onBackLinkClick:i}):(0,o.Y)(q,{onBackLinkClick:e.onBackLinkClick,onFactorSelected:e.onFactorSelected,onHavingTroubleClick:i})},q=e=>{const{onBackLinkClick:t,onHavingTroubleClick:r,onFactorSelected:n}=e,i=(0,S.f0)(),{supportedSecondFactors:l}=(0,a.useCoreSignIn)();return(0,o.Y)(s.Flow.Part,{part:"alternativeMethods",children:(0,o.FD)(u.Card,{children:[(0,o.Y)(u.CardAlert,{children:i.error}),(0,o.FD)(u.Header.Root,{children:[t&&(0,o.Y)(u.Header.BackLink,{onClick:t}),(0,o.Y)(u.Header.Title,{localizationKey:(0,s.localizationKeys)("signIn.alternativeMethods.title")})]}),(0,o.Y)(s.Col,{elementDescriptor:s.descriptors.main,gap:8,children:(0,o.Y)(s.Col,{gap:2,children:l.sort(h.Wy).map(((e,t)=>(0,o.Y)(u.ArrowBlockButton,{textLocalizationKey:Z(e),elementDescriptor:s.descriptors.alternativeMethodsBlockButton,textElementDescriptor:s.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:s.descriptors.alternativeMethodsBlockButtonArrow,isDisabled:i.isLoading,onClick:()=>n(e)},t)))})}),(0,o.FD)(u.Footer.Root,{children:[(0,o.Y)(u.Footer.Action,{elementId:"havingTrouble",children:(0,o.Y)(u.Footer.ActionLink,{localizationKey:(0,s.localizationKeys)("signIn.alternativeMethods.actionLink"),onClick:r})}),(0,o.Y)(u.Footer.Links,{})]})]})})};function Z(e){switch(e.strategy){case"phone_code":return(0,s.localizationKeys)("signIn.alternativeMethods.blockButton__phoneCode",{identifier:(0,h.uu)(e.safeIdentifier)||""});case"totp":return(0,s.localizationKeys)("signIn.alternativeMethods.blockButton__totp");case"backup_code":return(0,s.localizationKeys)("signIn.alternativeMethods.blockButton__backupCode");default:throw`Invalid sign in strategy: "${e.strategy}"`}}const j=e=>{const{onShowAlternativeMethodsClicked:t}=e,r=(0,a.useCoreSignIn)(),{displayConfig:n}=(0,a.useEnvironment)(),{navigateAfterSignIn:i}=(0,a.useSignInContext)(),{setActive:d}=(0,a.useCoreClerk)(),{navigate:f}=(0,l.useRouter)(),g=(0,p.p)(),m=(0,u.useCardState)(),C=(0,h.tJ)("code","",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__backupCode"),isRequired:!0}),v=(0,a.useCoreClerk)(),w=e=>{var t,r;return(0,P.Kw)(null===(t=e.firstFactorVerification)||void 0===t?void 0:t.strategy)&&"verified"===(null===(r=e.firstFactorVerification)||void 0===r?void 0:r.status)};return(0,o.FD)(u.Card,{children:[(0,o.Y)(u.CardAlert,{children:m.error}),(0,o.FD)(u.Header.Root,{children:[(0,o.Y)(u.Header.Title,{localizationKey:(0,s.localizationKeys)("signIn.backupCodeMfa.title")}),(0,o.Y)(u.Header.Subtitle,{localizationKey:w(r)?(0,s.localizationKeys)("signIn.forgotPassword.subtitle"):(0,s.localizationKeys)("signIn.backupCodeMfa.subtitle",{applicationName:n.applicationName})})]}),(0,o.Y)(s.Col,{elementDescriptor:s.descriptors.main,gap:8,children:(0,o.FD)(u.Form.Root,{onSubmit:e=>(e.preventDefault(),r.attemptSecondFactor({strategy:"backup_code",code:C.value}).then((e=>{if("complete"===e.status){if(w(e)&&e.createdSessionId){const t=new URLSearchParams;return t.set("createdSessionId",e.createdSessionId),f(`../reset-password-success?${t.toString()}`)}return d({session:e.createdSessionId,beforeEmit:i})}return console.error((0,c.wv)(e.status,g))})).catch((e=>{if((0,O._d)(e))return v.__internal_navigateWithError("..",e.errors[0]);(0,h.H4)(e,[C],m.setError)}))),children:[(0,o.Y)(u.Form.ControlRow,{elementId:C.id,children:(0,o.Y)(u.Form.Control,{...C.props,autoFocus:!0,onActionClicked:t})}),(0,o.Y)(u.Form.SubmitButton,{})]})}),(0,o.FD)(u.Footer.Root,{children:[(0,o.Y)(u.Footer.Action,{elementId:"alternativeMethods",children:t&&(0,o.Y)(u.Footer.ActionLink,{localizationKey:(0,s.localizationKeys)("footerActionLink__useAnotherMethod"),onClick:t})}),(0,o.Y)(u.Footer.Links,{})]})]})},X=e=>{const t=(0,a.useCoreSignIn)(),r=(0,u.useCardState)(),{navigateAfterSignIn:i}=(0,a.useSignInContext)(),{setActive:d}=(0,a.useCoreClerk)(),{navigate:f}=(0,l.useRouter)(),g=(0,p.p)(),m=(0,a.useCoreClerk)();n.useEffect((()=>{e.factorAlreadyPrepared||null==C||C()}),[]);const C=e.prepare?()=>{var t;return null===(t=e.prepare)||void 0===t?void 0:t.call(e).then((()=>e.onFactorPrepare())).catch((e=>{if((0,O._d)(e))return m.__internal_navigateWithError("..",e.errors[0]);(0,h.H4)(e,[],r.setError)}))}:void 0,v=e=>{var t,r;return(0,P.Kw)(null===(t=e.firstFactorVerification)||void 0===t?void 0:t.strategy)&&"verified"===(null===(r=e.firstFactorVerification)||void 0===r?void 0:r.status)};return(0,o.Y)(u.VerificationCodeCard,{cardTitle:e.cardTitle,cardSubtitle:v(t)?(0,s.localizationKeys)("signIn.forgotPassword.subtitle"):e.cardSubtitle,formTitle:e.formTitle,formSubtitle:e.formSubtitle,resendButton:e.resendButton,onCodeEntryFinishedAction:(r,o,n)=>{t.attemptSecondFactor({strategy:e.factor.strategy,code:r}).then((async e=>{if(await o(),"complete"===e.status){if(v(e)&&e.createdSessionId){const t=new URLSearchParams;return t.set("createdSessionId",e.createdSessionId),f(`../reset-password-success?${t.toString()}`)}return d({session:e.createdSessionId,beforeEmit:i})}return console.error((0,c.wv)(e.status,g))})).catch((e=>(0,O._d)(e)?m.__internal_navigateWithError("..",e.errors[0]):n(e)))},onResendCodeClicked:C,safeIdentifier:"safeIdentifier"in e.factor?e.factor.safeIdentifier:void 0,profileImageUrl:t.userData.imageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked,children:v(t)&&(0,o.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("signIn.resetPasswordMfa.detailsLabel"),variant:"smallRegular",colorScheme:"neutral"})})},ee=e=>{const t=(0,a.useCoreSignIn)();return(0,o.Y)(s.Flow.Part,{part:"phoneCode2Fa",children:(0,o.Y)(X,{...e,cardTitle:(0,s.localizationKeys)("signIn.phoneCodeMfa.title"),cardSubtitle:(0,s.localizationKeys)("signIn.phoneCodeMfa.subtitle"),formTitle:(0,s.localizationKeys)("signIn.phoneCodeMfa.formTitle"),formSubtitle:(0,s.localizationKeys)("signIn.phoneCodeMfa.formSubtitle"),resendButton:(0,s.localizationKeys)("signIn.phoneCodeMfa.resendButton"),prepare:()=>{const{phoneNumberId:r,strategy:o}=e.factor;return t.prepareSecondFactor({phoneNumberId:r,strategy:o})}})})},te=e=>(0,o.Y)(s.Flow.Part,{part:"totp2Fa",children:(0,o.Y)(X,{...e,cardTitle:(0,s.localizationKeys)("signIn.totpMfa.title"),cardSubtitle:(0,s.localizationKeys)("signIn.totpMfa.subtitle"),formTitle:(0,s.localizationKeys)("signIn.totpMfa.formTitle"),formSubtitle:(0,s.localizationKeys)("signIn.totpMfa.formSubtitle")})}),re=e=>{if(!e)return"";let t=e.strategy;return"phoneNumberId"in e&&(t+=e.phoneNumberId),t},oe=(0,d.K5)((0,u.withCardStateProvider)((function(){const e=(0,a.useCoreSignIn)().supportedSecondFactors,t=n.useRef(""),[r,i]=n.useState((()=>(0,P.R5)(e))),[s,l]=n.useState(!r),c=()=>l((e=>!e)),d=()=>{t.current=re(r)};if(!r)return(0,o.Y)(u.LoadingCard,{});if(s)return(0,o.Y)(J,{onBackLinkClick:c,onFactorSelected:e=>{i(e),c()}});switch(null==r?void 0:r.strategy){case"phone_code":return(0,o.Y)(ee,{factorAlreadyPrepared:t.current===re(r),onFactorPrepare:d,factor:r,onShowAlternativeMethodsClicked:c});case"totp":return(0,o.Y)(te,{factorAlreadyPrepared:t.current===re(r),onFactorPrepare:d,factor:r,onShowAlternativeMethodsClicked:c});case"backup_code":return(0,o.Y)(j,{onShowAlternativeMethodsClicked:c});default:return(0,o.Y)(u.LoadingCard,{})}}))),ne=(0,d.K5)(d.Fv);var ie=r(6480),ae=r(1857);const se=({field:e})=>{const[t,r]=(0,n.useState)(!1),i=(0,n.useRef)(null);return(0,n.useLayoutEffect)((()=>{const e=setInterval((()=>{if(null==i?void 0:i.current){const t="onAutoFillStart"===window.getComputedStyle(i.current,":autofill").animationName;t&&(r(t),clearInterval(e))}}),500);return()=>{clearInterval(e)}}),[]),(0,n.useEffect)((()=>{(null==e?void 0:e.value)&&""!==e.value&&r(!1)}),[null==e?void 0:e.value]),e?(0,o.Y)(u.Form.ControlRow,{elementId:e.id,sx:e.value||t?void 0:{opacity:0,height:0,pointerEvents:"none",marginTop:"-1rem"},children:(0,o.Y)(u.Form.Control,{...e.props,ref:i,tabIndex:e.value?void 0:-1})}):null},le=(0,d.K5)((0,u.withCardStateProvider)((function(){var e;const t=(0,u.useCardState)(),r=(0,a.useCoreClerk)(),i=(0,f.mN)(),{displayConfig:g,userSettings:m}=(0,a.useEnvironment)(),C=(0,a.useCoreSignIn)(),{navigate:v}=(0,l.useRouter)(),w=(0,a.useSignInContext)(),{navigateAfterSignIn:S,signUpUrl:I}=w,k=(0,p.p)(),y=(0,n.useMemo)((()=>(0,d.E9)(m.enabledFirstFactorIdentifiers)),[m.enabledFirstFactorIdentifiers]),_=!!(null===(e=w.initialValues)||void 0===e?void 0:e.phoneNumber)&&!(w.initialValues.emailAddress||w.initialValues.username)&&y.includes("phone_number"),[F,Y]=(0,n.useState)(_?"phone_number":y[0]||""),[A,P]=(0,n.useState)(!1),z=(0,ae.hI)("__clerk_ticket")||"",L=m.enabledFirstFactorIdentifiers,E=m.web3FirstFactors,M=m.authenticatableSocialStrategies,R=m.instanceIsPasswordBased,{currentIdentifier:B,nextIdentifier:D}=(0,d.ZN)(y,F),T=(0,h.tJ)("password","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__password"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__password")}),U=w.initialValues||{},O=(0,n.useMemo)((()=>({email_address:U.emailAddress,email_address_username:U.emailAddress||U.username,username:U.username,phone_number:U.phoneNumber})),[w.initialValues]),x=!!M.length||!!E.length,[H,N]=(0,n.useState)(!(0,h.Xb)()&&!x),V=(0,h.tJ)("identifier",O[F]||"",{...B,isRequired:!0}),W=(0,h.tJ)("identifier",O.phone_number||"",{...B,isRequired:!0}),Q="phone_number"===F?W:V,G=(0,n.useRef)(null);(0,n.useLayoutEffect)((()=>{var e;Q.value.startsWith("+")&&y.includes("phone_number")&&"phone_number"!==F&&!A&&(e=Q.value,V.setValue(O[F]||""),W.setValue(e),Y("phone_number"),N(!0),P(!0))}),[Q.value,y]),(0,n.useEffect)((()=>{z&&(i.setLoading(),t.setLoading(),C.create({strategy:"ticket",ticket:z}).then((e=>{switch(e.status){case"needs_first_factor":return v("factor-one");case"needs_second_factor":return v("factor-two");case"complete":return r.setActive({session:e.createdSessionId,beforeEmit:S});default:return void console.error((0,c.wv)(e.status,k))}})).catch((e=>q(e))).finally((()=>{i.setIdle(),t.setIdle()})))}),[]),(0,n.useEffect)((()=>{!async function(){var e;const r=null===(e=null==C?void 0:C.firstFactorVerification)||void 0===e?void 0:e.error;if(r){switch(r.code){case ie.OQ.NOT_ALLOWED_TO_SIGN_UP:case ie.OQ.OAUTH_ACCESS_DENIED:case ie.OQ.NOT_ALLOWED_ACCESS:case ie.OQ.SAML_USER_ATTRIBUTE_MISSING:case ie.OQ.OAUTH_EMAIL_DOMAIN_RESERVED_BY_SAML:case ie.OQ.USER_LOCKED:t.setError(r);break;default:t.setError("Unable to complete action at this time. If the problem persists please contact support.")}await C.create({})}}()}),[]);const $=async(...e)=>{try{const t=await C.create((e=>{const t=e.some((e=>"password"===e.name&&!!e.value));return t||(e=e.filter((e=>"password"!==e.name))),{...(0,h.mK)(e),...t&&{strategy:"password"}}})(e));switch(t.status){case"needs_identifier":t.supportedFirstFactors.some((e=>"saml"===e.strategy))&&await J();break;case"needs_first_factor":return v("factor-one");case"needs_second_factor":return v("factor-two");case"complete":return r.setActive({session:t.createdSessionId,beforeEmit:S});default:return void console.error((0,c.wv)(t.status,k))}}catch(t){return q(t)}},J=async()=>{const e=(0,b.u)(w,g.signInUrl),t=w.afterSignInUrl||g.afterSignInUrl;return C.authenticateWithRedirect({strategy:"saml",redirectUrl:e,redirectUrlComplete:t})},q=async e=>{if(!e.errors)return;const o=e.errors.find((e=>e.code===ie.OQ.INVALID_STRATEGY_FOR_USER||e.code===ie.OQ.FORM_PASSWORD_INCORRECT)),n=e.errors.find((e=>"identifier_already_signed_in"===e.code));if(o)await $(Q);else if(n){const e=n.meta.sessionId;await r.setActive({session:e,beforeEmit:S})}else(0,h.H4)(e,[Q,T],t.setError)};return i.isLoading?(0,o.Y)(u.LoadingCard,{}):(0,o.Y)(s.Flow.Part,{part:"start",children:(0,o.FD)(u.Card,{children:[(0,o.Y)(u.CardAlert,{children:t.error}),(0,o.FD)(u.Header.Root,{children:[(0,o.Y)(u.Header.Title,{localizationKey:(0,s.localizationKeys)("signIn.start.title")}),(0,o.Y)(u.Header.Subtitle,{localizationKey:(0,s.localizationKeys)("signIn.start.subtitle")})]}),(0,o.Y)(s.Col,{elementDescriptor:s.descriptors.main,gap:8,children:(0,o.FD)(u.SocialButtonsReversibleContainerWithDivider,{children:[x&&(0,o.Y)(K,{enableWeb3Providers:!0,enableOAuthProviders:!0}),L.length?(0,o.FD)(u.Form.Root,{onSubmit:async e=>(e.preventDefault(),$(Q,T)),children:[(0,o.Y)(u.Form.ControlRow,{elementId:Q.id,children:(0,o.Y)(u.Form.Control,{ref:G,actionLabel:null==D?void 0:D.action,onActionClicked:()=>{Y((e=>y[(y.indexOf(e)+1)%y.length])),N(!0),P(!1)},...Q.props,autoFocus:H})}),(0,o.Y)(se,{field:R?T:void 0}),(0,o.Y)(u.Form.SubmitButton,{})]}):null]})}),(0,o.FD)(u.Footer.Root,{children:[(0,o.FD)(u.Footer.Action,{elementId:"signIn",children:[(0,o.Y)(u.Footer.ActionText,{localizationKey:(0,s.localizationKeys)("signIn.start.actionText")}),(0,o.Y)(u.Footer.ActionLink,{localizationKey:(0,s.localizationKeys)("signIn.start.actionLink"),to:r.buildUrlWithAuth(I)})]}),(0,o.Y)(u.Footer.Links,{})]})]})})})));function ce(){const e=(0,a.useCoreClerk)();return n.useEffect((()=>{e.redirectToSignIn()}),[]),null}function de(){const e=(0,a.useSignInContext)();return(0,o.Y)(s.Flow.Root,{flow:"signIn",children:(0,o.FD)(l.Switch,{children:[(0,o.Y)(l.Route,{path:"factor-one",children:(0,o.Y)($,{})}),(0,o.Y)(l.Route,{path:"factor-two",children:(0,o.Y)(oe,{})}),(0,o.Y)(l.Route,{path:"reset-password",children:(0,o.Y)(g,{})}),(0,o.Y)(l.Route,{path:"reset-password-success",children:(0,o.Y)(v,{})}),(0,o.Y)(l.Route,{path:"sso-callback",children:(0,o.Y)(ne,{afterSignInUrl:e.afterSignInUrl,afterSignUpUrl:e.afterSignUpUrl,redirectUrl:e.redirectUrl,continueSignUpUrl:e.signUpContinueUrl,firstFactorUrl:"../factor-one",secondFactorUrl:"../factor-two",resetPasswordUrl:"../reset-password"})}),(0,o.Y)(l.Route,{path:"choose",children:(0,o.Y)(y,{})}),(0,o.Y)(l.Route,{path:"verify",children:(0,o.Y)(i.Y,{redirectUrlComplete:e.afterSignInUrl||e.redirectUrl||void 0,redirectUrl:"../factor-two"})}),(0,o.Y)(l.Route,{index:!0,children:(0,o.Y)(le,{})}),(0,o.Y)(l.Route,{children:(0,o.Y)(ce,{})})]})})}de.displayName="SignIn";const ue=(0,a.withCoreSessionSwitchGuard)(de),fe=e=>{const t={signUpUrl:`/${l.VIRTUAL_ROUTER_BASE_PATH}/sign-up`,...e};return(0,o.Y)(l.Route,{path:"sign-in",children:(0,o.Y)(a.ComponentContext.Provider,{value:{componentName:"SignIn",...t,routing:"virtual"},children:(0,o.Y)("div",{children:(0,o.Y)(ue,{...t,routing:"virtual"})})})})}},3863:function(e,t,r){r.d(t,{xf:function(){return f},R5:function(){return g},Cm:function(){return h},Kw:function(){return C}}),r(6874);var o=r(7425);const n=e=>e.reduce(((e,t,r)=>(e[t]=r,e)),{}),i=n(["password","email_link","email_code","phone_code"]),a=n(["email_link","email_code","phone_code","password"]),s=n(["email_link","email_code","phone_code","password"]),l=e=>(t,r)=>{const o=e[t.strategy],n=e[r.strategy];return void 0===o||void 0===n?0:o-n},c=l(i),d=l(a);l(s);const u=e=>t=>"safeIdentifier"in t&&t.safeIdentifier===e;function f(e,t,r){return e&&0!==e.length?r===o._o.Password?function(e,t){const r=e.sort(c)[0];return"password"===r.strategy?r:e.find(u(t))||r||null}(e,t):function(e,t){const r=e.sort(d),o=r.find(u(t));if(o)return o;const n=r[0];return"email_link"===n.strategy?n:e.find(u(t))||n||null}(e,t):null}const p=["email_code","password","phone_code","email_link"];function h(e){return!!e&&p.includes(e.strategy)}function g(e){if(!e||0===e.length)return null;const t=e.find((e=>"totp"===e.strategy));if(t)return t;return e.find((e=>"phone_code"===e.strategy))||e[0]}const m=["reset_password_phone_code","reset_password_email_code"],C=e=>!!e&&m.includes(e)},3962:function(e,t,r){r.d(t,{u:function(){return c}});var o=r(7780),n=r(3132),i=r(4740),a=r(2932),s=r(166),l=r(3150);const c=e=>{const{setActive:t,signOut:r,openUserProfile:c}=(0,i.useCoreClerk)(),d=(0,a.useCardState)(),u=(0,i.useCoreSessionList)(),{navigate:f}=(0,s.useRouter)(),p=u.filter((e=>"active"===e.status)),h=p.filter((t=>{var r,o;return(null===(r=t.user)||void 0===r?void 0:r.id)!==(null===(o=e.user)||void 0===o?void 0:o.id)}));return{handleSignOutSessionClicked:t=>()=>0===h.length?r(e.navigateAfterSignOut):r(e.navigateAfterMultiSessionSingleSignOut,{sessionId:t.id}).finally((()=>d.setIdle())),handleManageAccountClicked:()=>{var t,r,n;return"navigation"===e.userProfileMode?f(e.userProfileUrl||"").finally((()=>{(async()=>{var t;await(0,l.yy)(300),null===(t=e.actionCompleteCallback)||void 0===t||t.call(e)})()})):((null===(t=e.appearance)||void 0===t?void 0:t.userProfile)&&(0,o.W1)(e.appearance,"userProfile","Use `<UserButton userProfileProps={{appearance: {...}}} />` instead."),c({appearance:null===(r=e.appearance)||void 0===r?void 0:r.userProfile,...e.userProfileProps}),null===(n=e.actionCompleteCallback)||void 0===n?void 0:n.call(e))},handleSignOutAllClicked:()=>r(e.navigateAfterSignOut),handleSessionClicked:r=>async()=>(d.setLoading(),t({session:r,beforeEmit:e.navigateAfterSwitchSession}).finally((()=>{var t;d.setIdle(),null===(t=e.actionCompleteCallback)||void 0===t||t.call(e)}))),handleAddAccountClicked:()=>((0,n.y)(e.signInUrl||window.location.href),(0,l.yy)(2e3)),otherSessions:h,activeSessions:p}}}}]);