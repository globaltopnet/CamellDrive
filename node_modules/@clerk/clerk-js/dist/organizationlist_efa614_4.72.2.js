"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[578],{8382:function(i,e,t){t.r(e),t.d(e,{OrganizationList:function(){return _}});var n=t(4380),a=t(5220),o=t(4740),r=t(9333),s=t(166),l=t(4041),c=t(2932),d=t(7157),u=t(2916),g=t(2407),h=t(3965);const p=i=>(0,n.Y)(r.Col,{elementDescriptor:r.descriptors.organizationListPreviewItems,sx:i=>({maxHeight:`calc(8 * ${i.sizes.$12})`,overflowY:"auto",...h.common.unstyledScrollbar(i)}),children:i.children}),z=i=>({height:i.space.$12,padding:`${i.space.$2} ${i.space.$8}`}),v=i=>({fontSize:i.fontSizes.$md,fontWeight:i.fontWeights.$normal,color:i.colors.$colorText}),m=i=>(0,n.FD)(r.Flex,{align:"center",gap:2,sx:[i=>({minHeight:"unset",justifyContent:"space-between"}),z],elementDescriptor:r.descriptors.organizationListPreviewItem,children:[(0,n.Y)(c.OrganizationPreview,{elementId:"organizationList",size:"sm",mainIdentifierSx:v,organization:i.organizationData}),i.children]}),C=(0,l.forwardRef)(((i,e)=>(0,n.Y)(r.Box,{ref:e,sx:i=>({width:"100%",height:i.space.$12,position:"relative"}),children:(0,n.Y)(r.Box,{sx:{margin:"auto",position:"absolute",left:"50%",top:"50%",transform:"translateY(-50%) translateX(-50%)"},children:(0,n.Y)(r.Spinner,{size:"sm",colorScheme:"primary"})})}))),S=i=>(0,n.Y)(r.Button,{elementDescriptor:r.descriptors.organizationListPreviewItemActionButton,textVariant:"buttonExtraSmallBold",variant:"outline",colorScheme:"neutral",size:"sm",...i}),L=i=>(0,n.Y)(c.PreviewButton,{elementDescriptor:r.descriptors.organizationListPreviewButton,sx:[z],icon:g.fl,iconProps:{size:"md"},showIconOnHover:!1,...i});var Y=t(3150),w=t(4683),x=t(2234);const f=(0,c.withCardStateProvider)((i=>{const e=(0,c.useCardState)(),{navigateAfterSelectOrganization:t}=(0,o.useOrganizationListContext)(),{isLoaded:a,setActive:r}=(0,o.useCoreOrganizationList)();return a?(0,n.Y)(L,{onClick:()=>{return n=i.organization,e.runAsync((async()=>{await r({organization:n}),await t(n)}));var n},children:(0,n.Y)(c.OrganizationPreview,{elementId:"organizationList",size:"sm",mainIdentifierSx:v,organization:i.organization})}):null})),$=(0,c.withCardStateProvider)((()=>{const i=(0,c.useCardState)(),{hidePersonal:e,navigateAfterSelectPersonal:t}=(0,o.useOrganizationListContext)(),{isLoaded:a,setActive:r}=(0,o.useCoreOrganizationList)(),s=(0,o.useCoreUser)(),{username:l,primaryEmailAddress:d,primaryPhoneNumber:u,...g}=s;return e?null:(0,n.Y)(L,{onClick:()=>{if(a)return i.runAsync((async()=>{await r({organization:null}),await t(s)}))},children:(0,n.Y)(c.PersonalWorkspacePreview,{user:g,size:"sm",mainIdentifierSx:v,title:(0,x.GQ)("organizationSwitcher.personalWorkspace")})})})),y={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},P=i=>{const e=(0,c.useCardState)();return(0,n.Y)(S,{isLoading:e.isLoading,onClick:i.onAccept,localizationKey:(0,r.localizationKeys)("organizationList.action__invitationAccept")})},O=(0,c.withCardStateProvider)((i=>{const e=(0,c.useCardState)(),{getOrganization:t}=(0,o.useCoreClerk)(),[a,r]=(0,l.useState)(null),{userInvitations:s}=(0,o.useCoreOrganizationList)({userInvitations:y.userInvitations});return a?(0,n.Y)(f,{organization:a}):(0,n.Y)(m,{organizationData:i.publicOrganizationData,children:(0,n.Y)(P,{onAccept:()=>e.runAsync((async()=>[await i.accept(),await t(i.publicOrganizationData.id)])).then((([i,e])=>{var t;null===(t=null==s?void 0:s.setData)||void 0===t||t.call(s,(e=>(0,w.l_)(i,e))),r(e)})).catch((i=>(0,Y.H4)(i,[],e.setError)))})})})),b=i=>{const e=(0,c.useCardState)(),{userSuggestions:t}=(0,o.useCoreOrganizationList)({userSuggestions:y.userSuggestions});return"accepted"===i.status?(0,n.Y)(r.Text,{variant:"smallRegular",colorScheme:"neutral",localizationKey:(0,r.localizationKeys)("organizationList.suggestionsAcceptedLabel")}):(0,n.Y)(S,{isLoading:e.isLoading,onClick:()=>e.runAsync(i.accept).then((i=>{var e;return null===(e=null==t?void 0:t.setData)||void 0===e?void 0:e.call(t,(e=>(0,w.l_)(i,e)))})).catch((i=>(0,Y.H4)(i,[],e.setError))),localizationKey:(0,r.localizationKeys)("organizationList.action__suggestionsAccept")})},D=(0,c.withCardStateProvider)((i=>(0,n.Y)(m,{organizationData:i.publicOrganizationData,children:(0,n.Y)(b,{...i})}))),I=()=>{const{userMemberships:i,userInvitations:e,userSuggestions:t}=(0,o.useCoreOrganizationList)(y),{ref:n}=(0,d.Wx)({threshold:0,onChange:n=>{var a,o,r;n&&(i.hasNextPage?null===(a=i.fetchNext)||void 0===a||a.call(i):e.hasNextPage?null===(o=e.fetchNext)||void 0===o||o.call(e):null===(r=t.fetchNext)||void 0===r||r.call(t))}});return{userMemberships:i,userInvitations:e,userSuggestions:t,ref:n}},k=(0,c.withCardStateProvider)((()=>{const i=(0,c.useCardState)(),{userMemberships:e,userSuggestions:t,userInvitations:a}=I(),s=(null==e?void 0:e.isLoading)||(null==a?void 0:a.isLoading)||(null==t?void 0:t.isLoading),l=!!((null==e?void 0:e.count)||(null==a?void 0:a.count)||(null==t?void 0:t.count)),{hidePersonal:d}=(0,o.useOrganizationListContext)();return(0,n.FD)(c.Card,{sx:i=>({padding:`${i.space.$8} ${i.space.$none}`}),insideAppLogoSx:i=>({padding:`${i.space.$none} ${i.space.$8}`}),gap:6,children:[(0,n.Y)(c.CardAlert,{children:i.error}),s&&(0,n.Y)(r.Flex,{direction:"row",align:"center",justify:"center",sx:i=>({height:"100%",minHeight:i.sizes.$60}),children:(0,n.Y)(r.Spinner,{size:"lg",colorScheme:"primary"})}),!s&&(0,n.Y)(F,{showListInitially:!(d&&!l)})]})})),A=(0,c.withCardStateProvider)((i=>{const{showListInitially:e,isCreateOrganizationFlow:t,setCreateOrganizationFlow:a}=i,s=(0,o.useEnvironment)(),{navigateAfterCreateOrganization:l,skipInvitationScreen:c}=(0,o.useOrganizationListContext)();return(0,n.Y)(n.FK,{children:(0,n.Y)(r.Box,{sx:i=>({padding:`${i.space.$none} ${i.space.$8}`}),children:(0,n.Y)(u.A,{flow:"organizationList",skipInvitationScreen:c,startPage:{headerTitle:(0,r.localizationKeys)("createOrganization.title"),headerSubtitle:(0,r.localizationKeys)("organizationList.subtitle",{applicationName:s.displayConfig.applicationName})},navigateAfterCreateOrganization:i=>l(i).then((()=>a(!1))),onCancel:e&&t?()=>a(!1):void 0})})})})),F=({showListInitially:i})=>{const[e,t]=(0,l.useState)(!i);return(0,n.FD)(n.FK,{children:[!e&&(0,n.Y)(K,{onCreateOrganizationClick:()=>t(!0)}),e&&(0,n.Y)(A,{isCreateOrganizationFlow:e,setCreateOrganizationFlow:t,showListInitially:i})]})},K=(0,c.withCardStateProvider)((i=>{var e,t,a;const s=(0,c.useCardState)(),l=(0,o.useEnvironment)(),{ref:d,userMemberships:u,userSuggestions:g,userInvitations:h}=I(),{hidePersonal:z}=(0,o.useOrganizationListContext)(),v=(null==u?void 0:u.isLoading)||(null==h?void 0:h.isLoading)||(null==g?void 0:g.isLoading),m=(null==u?void 0:u.hasNextPage)||(null==h?void 0:h.hasNextPage)||(null==g?void 0:g.hasNextPage);return(0,n.FD)(n.FK,{children:[(0,n.Y)(c.CardAlert,{children:s.error}),(0,n.FD)(c.Header.Root,{sx:i=>({padding:`${i.space.$none} ${i.space.$8}`}),children:[(0,n.Y)(c.Header.Title,{localizationKey:(0,r.localizationKeys)(z?"organizationList.titleWithoutPersonal":"organizationList.title")}),(0,n.Y)(c.Header.Subtitle,{localizationKey:(0,r.localizationKeys)("organizationList.subtitle",{applicationName:l.displayConfig.applicationName})})]}),(0,n.FD)(r.Col,{elementDescriptor:r.descriptors.main,gap:6,children:[(0,n.FD)(p,{children:[(0,n.Y)($,{}),(u.count||0)>0&&(null===(e=u.data)||void 0===e?void 0:e.map((i=>(0,n.Y)(f,{...i},i.id)))),!u.hasNextPage&&(h.count||0)>0&&(null===(t=h.data)||void 0===t?void 0:t.map((i=>(0,n.Y)(O,{...i},i.id)))),!u.hasNextPage&&!h.hasNextPage&&(g.count||0)>0&&(null===(a=g.data)||void 0===a?void 0:a.map((i=>(0,n.Y)(D,{...i},i.id)))),(m||v)&&(0,n.Y)(C,{ref:d})]}),(0,n.Y)(c.Divider,{sx:i=>({padding:`${i.space.$none} ${i.space.$8}`})},"divider"),(0,n.Y)(r.Flex,{align:"center",justify:"between",sx:i=>({padding:`${i.space.$none} ${i.space.$8}`}),children:(0,n.Y)(r.Button,{elementDescriptor:r.descriptors.button,block:!0,colorScheme:"neutral",variant:"outline",textVariant:"buttonExtraSmallBold",onClick:()=>{i.onCreateOrganizationClick()},localizationKey:(0,r.localizationKeys)("organizationList.action__createOrganization")})})]})]})})),N=(0,o.withCoreUserGuard)(k),_=(0,a.$D)((()=>(0,n.Y)(r.Flow.Root,{flow:"organizationList",children:(0,n.Y)(r.Flow.Part,{children:(0,n.Y)(s.Switch,{children:(0,n.Y)(s.Route,{children:(0,n.Y)(N,{})})})})})),"OrganizationList",{mode:"redirect"})}}]);